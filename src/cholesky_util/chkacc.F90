!***********************************************************************
! This file is part of OpenMolcas.                                     *
!                                                                      *
! OpenMolcas is free software; you can redistribute it and/or modify   *
! it under the terms of the GNU Lesser General Public License, v. 2.1. *
! OpenMolcas is distributed in the hope that it will be useful, but it *
! is provided "as is" and without any express or implied warranties.   *
! For more details see the full text of the license in the file        *
! LICENSE or in <http://www.gnu.org/licenses/>.                        *
!                                                                      *
! Copyright (C) 2007, Ten-no Research Group                            *
!               2012, Thomas Bondo Pedersen                            *
!***********************************************************************

subroutine ChkAcc(K,InitR,Error,R,Change)
!-----------------------------------------------------------------------
! Function : Check the convergence
!-----------------------------------------------------------------------

use ReMez_mod

implicit real*8(A-H,O-Z)
parameter(ZERO=0.0D+00)
real*8 E2(7), E5(7), E10(16), E20(17), E30(17), E40(18), E50(19), E60(20), E70(20), E80(20), E90(20), E100(20), E200(20), &
       E300(20), E400(20), E500(20), E600(20), E700(20), E800(20), E900(20), E1000(20), E2000(20), E3000(20), E4000(20), &
       E5000(20), E6000(20), E7000(20), E8000(20), E9000(20), E10000(20), ERMax(20), RList(30)
logical Change
data RList/2.0D+00,5.0D+00,1.0D+01,2.0D+01,3.0D+01,4.0D+01,5.0D+01,6.0D+01,7.0D+01,8.0D+01,9.0D+01,1.0D+02,2.0D+02,3.0D+02, &
           4.0D+02,5.0D+02,6.0D+02,7.0D+02,8.0D+02,9.0D+02,1.0D+03,2.0D+03,3.0D+03,4.0D+03,5.0D+03,6.0D+03,7.0D+03,8.0D+03, &
           9.0D+03,1.0D+04/
data E2/2.128D-02,2.080D-04,1.833D-06,1.542D-08,1.261D-10,1.012D-12,8.020D-15/
data E5/7.075D-02,3.437D-03,1.500D-04,6.258D-06,2.543D-07,1.016D-08,4.007D-10/
data E10/8.556D-02,8.752D-03,7.145D-04,5.577D-05,4.243D-06,3.173D-07,2.344D-08,1.716D-09,1.248D-10,9.021D-12,6.492D-13,4.654D-14, &
         3.326D-15,2.371D-16,1.708D-17,5.136D-18/
data E20/0.000D+00,1.448D-02,1.819D-03,2.169D-04,2.521D-05,2.880D-06,3.252D-07,3.640D-08,4.045D-09,4.470D-10,4.918D-11,5.389D-12, &
         5.888D-13,6.414D-14,6.972D-15,7.562D-16,8.202D-17/
data E30/0.000D+00,1.699D-02,2.627D-03,3.795D-04,5.336D-05,7.379D-06,1.008D-06,1.365D-07,1.836D-08,2.456D-09,3.270D-10,4.337D-11, &
         5.735D-12,7.562D-13,9.947D-14,1.306D-14,1.711D-15/
data E40/0.000D+00,1.784D-02,3.215D-03,5.230D-04,8.266D-05,1.285D-05,1.973D-06,3.003D-07,4.539D-08,6.822D-09,1.021D-09,1.522D-10, &
         2.262D-11,3.352D-12,4.956D-13,7.312D-14,1.077D-14,1.584D-15/
data E50/0.000D+00,1.785D-02,3.659D-03,6.469D-04,1.110D-04,1.872D-05,3.121D-06,5.155D-07,8.456D-08,1.380D-08,2.241D-09,3.625D-10, &
         5.847D-11,9.405D-12,1.509D-12,2.417D-13,3.863D-14,6.165D-15,9.826D-16/
data E60/0.000D+00,0.000D+00,4.001D-03,7.541D-04,1.377D-04,2.471D-05,4.382D-06,7.701D-07,1.344D-07,2.333D-08,4.031D-09,6.939D-10, &
         1.191D-10,2.038D-11,3.479D-12,5.927D-13,1.008D-13,1.711D-14,2.902D-15,4.914D-16/
data E70/0.000D+00,0.000D+00,4.271D-03,8.474D-04,1.626D-04,3.066D-05,5.711D-06,1.054D-06,1.933D-07,3.525D-08,6.398D-09,1.157D-09, &
         2.085D-10,3.749D-11,6.723D-12,1.203D-12,2.150D-13,3.834D-14,6.829D-15,1.215D-15/
data E80/0.000D+00,0.000D+00,4.485D-03,9.293D-04,1.858D-04,3.648D-05,7.077D-06,1.361D-06,2.598D-07,4.932D-08,9.323D-09,1.756D-09, &
         3.295D-10,6.169D-11,1.152D-11,2.147D-12,4.004D-13,7.420D-14,1.376D-14,2.549D-15/
data E90/0.000D+00,0.000D+00,4.655D-03,1.002D-03,2.074D-04,4.213D-05,8.458D-06,1.683D-06,3.325D-07,6.532D-08,1.278D-08,2.490D-09, &
         4.836D-10,9.369D-11,1.811D-11,3.492D-12,6.723D-13,1.292D-13,2.480D-14,4.754D-15/
data E100/0.000D+00,0.000D+00,4.789D-03,1.066D-03,2.274D-04,4.760D-05,9.841D-06,2.016D-06,4.103D-07,8.303D-08,1.673D-08,3.357D-09, &
          6.716D-10,1.340D-10,2.667D-11,5.298D-12,1.050D-12,2.079D-13,4.110D-14,8.114D-15/
data E200/0.000D+00,0.000D+00,5.052D-03,1.456D-03,3.707D-04,9.217D-05,2.261D-05,5.498D-06,1.327D-06,3.186D-07,7.613D-08,1.812D-08, &
          4.301D-09,1.018D-09,2.403D-10,5.663D-11,1.332D-11,3.128D-12,7.333D-13,1.717D-13/
data E300/0.000D+00,0.000D+00,0.000D+00,1.628D-03,4.554D-04,1.235D-04,3.297D-05,8.724D-06,2.292D-06,5.986D-07,1.557D-07,4.032D-08, &
          1.041D-08,2.681D-09,6.888D-10,1.766D-10,4.519D-11,1.155D-11,2.946D-12,7.507D-13/
data E400/0.000D+00,0.000D+00,0.000D+00,1.695D-03,5.117D-04,1.467D-04,4.141D-05,1.157D-05,3.209D-06,8.850D-07,2.430D-07,6.645D-08, &
          1.812D-08,4.926D-09,1.336D-09,3.616D-10,9.771D-11,2.636D-11,7.099D-12,1.910D-12/
data E500/0.000D+00,0.000D+00,0.000D+00,1.700D-03,5.517D-04,1.649D-04,4.842D-05,1.407D-05,4.061D-06,1.165D-06,3.326D-07,9.463D-08, &
          2.683D-08,7.587D-09,2.140D-09,6.025D-10,1.693D-10,4.750D-11,1.331D-11,3.723D-12/
data E600/0.000D+00,0.000D+00,0.000D+00,0.000D+00,5.811D-04,1.795D-04,5.438D-05,1.630D-05,4.848D-06,1.434D-06,4.221D-07,1.238D-07, &
          3.618D-08,1.055D-08,3.067D-09,8.902D-10,2.579D-10,7.459D-11,2.154D-11,6.213D-12/
data E700/0.000D+00,0.000D+00,0.000D+00,0.000D+00,6.031D-04,1.915D-04,5.952D-05,1.829D-05,5.577D-06,1.691D-06,5.101D-07,1.533D-07, &
          4.594D-08,1.372D-08,4.091D-09,1.217D-09,3.613D-10,1.071D-10,3.170D-11,9.371D-12/
data E800/0.000D+00,0.000D+00,0.000D+00,0.000D+00,6.193D-04,2.016D-04,6.401D-05,2.008D-05,6.252D-06,1.935D-06,5.960D-07,1.829D-07, &
          5.593D-08,1.706D-08,5.190D-09,1.576D-09,4.776D-10,1.445D-10,4.367D-11,1.318D-11/
data E900/0.000D+00,0.000D+00,0.000D+00,0.000D+00,6.309D-04,2.102D-04,6.799D-05,2.172D-05,6.881D-06,2.167D-06,6.795D-07,2.122D-07, &
          6.605D-08,2.050D-08,6.349D-09,1.962D-09,6.052D-10,1.864D-10,5.732D-11,1.760D-11/
data E1000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,6.385D-04,2.177D-04,7.153D-05,2.321D-05,7.468D-06,2.389D-06,7.605D-07, &
           2.412D-07,7.623D-08,2.403D-08,7.555D-09,2.371D-09,7.426D-10,2.322D-10,7.251D-11,2.261D-11/
data E2000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,6.428D-04,2.570D-04,9.365D-05,3.341D-05,1.180D-05,4.140D-06,1.445D-06, &
           5.025D-07,1.741D-07,6.017D-08,2.074D-08,7.134D-09,2.450D-09,8.396D-10,2.874D-10,9.824D-11/
data E3000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,2.646D-04,1.047D-04,3.926D-05,1.456D-05,5.360D-06,1.963D-06, &
           7.157D-07,2.601D-07,9.426D-08,3.407D-08,1.229D-08,4.425D-09,1.590D-09,5.708D-10,2.046D-10/
data E4000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,1.110D-04,4.316D-05,1.654D-05,6.284D-06,2.375D-06, &
           8.936D-07,3.351D-07,1.253D-07,4.673D-08,1.739D-08,6.461D-09,2.396D-09,8.873D-10,3.281D-10/
data E5000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,1.146D-04,4.596D-05,1.804D-05,7.020D-06,2.715D-06, &
           1.046D-06,4.013D-07,1.536D-07,5.861D-08,2.232D-08,8.484D-09,3.220D-09,1.220D-09,4.617D-10/
data E6000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,1.162D-04,4.807D-05,1.923D-05,7.626D-06,3.004D-06, &
           1.178D-06,4.604D-07,1.794D-07,6.972D-08,2.704D-08,1.046D-08,4.043D-09,1.560D-09,6.011D-10/
data E7000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,1.163D-04,4.969D-05,2.021D-05,8.137D-06,3.254D-06, &
           1.295D-06,5.138D-07,2.032D-07,8.014D-08,3.154D-08,1.239D-08,4.858D-09,1.902D-09,7.438D-10/
data E8000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,5.096D-05,2.103D-05,8.576D-06,3.474D-06, &
           1.400D-06,5.624D-07,2.252D-07,8.993D-08,3.584D-08,1.425D-08,5.659D-09,2.244D-09,8.883D-10/
data E9000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,5.195D-05,2.172D-05,8.958D-06,3.669D-06, &
           1.495D-06,6.070D-07,2.457D-07,9.917D-08,3.995D-08,1.606D-08,6.445D-09,2.582D-09,1.033D-09/
data E10000/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,5.271D-05,2.232D-05,9.296D-06,3.844D-06, &
           1.582D-06,6.481D-07,2.648D-07,1.079D-07,4.388D-08,1.780D-08,7.213D-09,2.918D-09,1.179D-09/
data ERMax/0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,0.000D+00,5.392D-05,2.611D-05,1.312D-05,6.807D-06, &
           3.630D-06,1.984D-06,1.108D-06,6.311D-07,3.659D-07,2.155D-07,1.289D-07,7.811D-08,4.794D-08/

goto(20,50,110,120,130,140,150,160,170,180,190,210,220,230,240,250,260,270,280,290,310,320,330,340,350,360,370,380,390,410,999), &
    InitR

20 continue
ErrMin = E2(K)
ErrMax = E5(K)
goto 900
50 continue
ErrMin = E5(K)
ErrMax = E10(K)
goto 900
110 continue
ErrMin = E10(K)
ErrMax = E20(K)
goto 900
120 continue
ErrMin = E20(K)
ErrMax = E30(K)
goto 900
130 continue
ErrMin = E30(K)
ErrMax = E40(K)
goto 900
140 continue
ErrMin = E40(K)
ErrMax = E50(K)
goto 900
150 continue
ErrMin = E50(K)
ErrMax = E60(K)
goto 900
160 continue
ErrMin = E60(K)
ErrMax = E70(K)
goto 900
170 continue
ErrMin = E70(K)
ErrMax = E80(K)
goto 900
180 continue
ErrMin = E80(K)
ErrMax = E90(K)
goto 900
190 continue
ErrMin = E90(K)
ErrMax = E100(K)
goto 900
210 continue
ErrMin = E100(K)
ErrMax = E200(K)
goto 900
220 continue
ErrMin = E200(K)
ErrMax = E300(K)
goto 900
230 continue
ErrMin = E300(K)
ErrMax = E400(K)
goto 900
240 continue
ErrMin = E400(K)
ErrMax = E500(K)
goto 900
250 continue
ErrMin = E500(K)
ErrMax = E600(K)
goto 900
260 continue
ErrMin = E600(K)
ErrMax = E700(K)
goto 900
270 continue
ErrMin = E700(K)
ErrMax = E800(K)
goto 900
280 continue
ErrMin = E800(K)
ErrMax = E900(K)
goto 900
290 continue
ErrMin = E900(K)
ErrMax = E1000(K)
goto 900
310 continue
ErrMin = E1000(K)
ErrMax = E2000(K)
goto 900
320 continue
ErrMin = E2000(K)
ErrMax = E3000(K)
goto 900
330 continue
ErrMin = E3000(K)
ErrMax = E4000(K)
goto 900
340 continue
ErrMin = E4000(K)
ErrMax = E5000(K)
goto 900
350 continue
ErrMin = E5000(K)
ErrMax = E6000(K)
goto 900
360 continue
ErrMin = E6000(K)
ErrMax = E7000(K)
goto 900
370 continue
ErrMin = E7000(K)
ErrMax = E8000(K)
goto 900
380 continue
ErrMin = E8000(K)
ErrMax = E9000(K)
goto 900
390 continue
ErrMin = E9000(K)
ErrMax = E10000(K)
goto 900
410 continue
ErrMin = E10000(K)
ErrMax = ERMax(K)

900 continue
write(IW,'(/A/)') ' Check the accuracy of the convergence'
write(IW,'(A,F10.3,2X,A,E18.9E2)') ' R =',RList(InitR),'Maximum error = ',ErrMin
write(IW,'(A,F10.3,2X,A,E18.9E2)') ' R =',R,'Maximum error = ',Error
write(IW,'(A,F10.3,2X,A,E18.9E2/)') ' R =',RList(InitR+1),'Maximum error = ',ErrMax
if ((Error > ErrMin) .and. (Error < ErrMax)) then
  write(IW,'(A)') ' Convergence is GOOD.'
  Change = .false.
else
  write(IW,'(A)') ' Convergence is not good.'
  InitR = InitR+1
  Change = .true.
end if

999 continue
return

end subroutine ChkAcc
