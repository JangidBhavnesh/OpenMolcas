*-------------------------------------------------------------------------------
* Molecule: H2O
* Basis: STO-3G
* Symmetry: C1
* Features tested: ESPF optimization
* Responsible person:
* Comments:
*-------------------------------------------------------------------------------
 
> COPY file.xyz $Project.xyz
> COPY file.key $Project.key

* Test if Tinker is available and skip the test if not
> RM -FORCE TEST_TINKER
> IF ( $MOLCAS_DRIVER = UNKNOWN_VARIABLE )
>   EXPORT MOLCAS_DRIVER=molcas
> ENDIF
> IF ( -FILE $MOLCAS/tinker/bin/tkr2qm_s )
>   EXPORT TINKER=$MOLCAS/tinker/bin
> ENDIF
> SHELL $MOLCAS_DRIVER have_feature tinker || touch TEST_TINKER
> IF ( -FILE TEST_TINKER )
>   EXIT 36
> ENDIF

* another trick to set maximum memory
* (tinker requires quite a bit and crashes if memory is low)
> EXPORT MEMLIM=1024
> SHELL sh checkmem
> IF ( -FILE reduce_mem )
>   EXPORT MOLCAS_MEM=$MEMLIM
> ENDIF

&GATEWAY
  Tinker
  Basis = STO-3G
  group = C1
  RICD

> Do while

&SEWARD

&ESPF
  External = Tinker
  LAMorok

&SCF
  Charge = 0

&SLAPAF
  rhidden = 3.0

> End do

> FILE checkmem
if [ $MOLCAS_MEM -gt $MEMLIM ] ; then
  touch reduce_mem
fi
> EOF

> FILE file.xyz
     6  Water
     1  OW     1.282255    0.559451    2.778995  1     2     3
     2  HW     1.282255    1.316401    2.193113  2     1
     3  HW     1.282255   -0.197499    2.193113  2     1
     4  OW     0.349673    0.476493    5.425221  1     5     6
     5  HW     1.185602    0.528178    5.886092  2     4
     6  HW     0.600165    0.505265    4.489875  2     4
> EOF

> FILE file.key
parameters NONE

vdwtype                 LENNARD-JONES
radiusrule              ARITHMETIC
radiustype              R-MIN
radiussize              RADIUS
epsilonrule             GEOMETRIC
vdw-14-scale            2.0
chg-14-scale            1.2
electric                332.0522173
dielectric              1.0

atom       1   1    OW    "TIP3P Oxygen"                 8    16.000    2
atom       2   2    HW    "TIP3P Hydrogen"               1     1.008    1

vdw        1             1.7683     0.1520
vdw        2             0.0000     0.0000

bond       1   2         553.00     0.9572

angle      2   1   2     100.00     104.52

charge     1              -0.8340
charge     2               0.4170

QMMM 3
QM 1
QM 2
QM 3

QMMM-microiteration ON
> EOF

>>FILE checkfile
* This file is autogenerated:
* Molcas version 24.10-1461-g720ebb116
* Linux otis 5.15.0-119-generic #129-Ubuntu SMP Fri Aug 2 19:25:20 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
* Fri Dec 13 10:53:13 2024
*
#>>   1
#> POTNUC="9.194968955245"/12
#>>   2
#> POTNUC="9.194968955245"/6
#> SEWARD_MLTPL1X="2.423110773576"/5
#> SEWARD_KINETIC="29.003204064678"/5
#> SEWARD_ATTRACT="-61.724137094240"/5
#>>   3
#> POTNUC="9.501863882967"/6
#>>   4
#> SCF_ITER="7"/8
#> E_SCF="-74.966587146496"/4
#> ESPF_MULTIPOLES[0]="-0.651640352552"/6
#> ESPF_MULTIPOLES[1]="0.326072843350"/6
#> ESPF_MULTIPOLES[2]="0.326104869414"/6
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="-0.000000000000"/2
#> MLTPL__1[1]="0.000190591284"/2
#> MLTPL__1[2]="-0.719186077751"/2
#> MLTPL__2[0]="-1.019451597914"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="1.017102323208"/2
#> MLTPL__2[4]="-0.000156972680"/2
#> MLTPL__2[5]="0.002349274706"/2
#>>   5
#> GRAD[0]="0.0"/6
#> GRAD[1]="-0.000016285653"/6
#> GRAD[2]="-0.058165079233"/6
#> GRAD[3]="0.0"/6
#> GRAD[4]="-0.025512285779"/6
#> GRAD[5]="0.029050137034"/6
#> GRAD[6]="0.0"/6
#> GRAD[7]="0.025528571433"/6
#> GRAD[8]="0.029114942199"/6
#> GRAD[0]="-0.000061406062"/6
#> GRAD[1]="-0.000013563144"/6
#> GRAD[2]="-0.056302126660"/6
#> GRAD[3]="0.000030823666"/6
#> GRAD[4]="-0.024658634554"/6
#> GRAD[5]="0.028142311179"/6
#> GRAD[6]="0.000021206600"/6
#> GRAD[7]="0.024723902402"/6
#> GRAD[8]="0.028248605903"/6
#>>   6
#>>   7
#>>   9
#> POTNUC="8.946097893484"/6
#> SEWARD_MLTPL1X="2.423144699210"/5
#> SEWARD_KINETIC="29.003204064678"/5
#> SEWARD_ATTRACT="-61.693357810117"/5
#>>  10
#> POTNUC="9.253803998406"/6
#>>  11
#> SCF_ITER="7"/8
#> E_SCF="-74.969015308745"/4
#> ESPF_MULTIPOLES[0]="-0.611254234080"/6
#> ESPF_MULTIPOLES[1]="0.305876957926"/6
#> ESPF_MULTIPOLES[2]="0.305918220906"/6
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="-0.000083517831"/2
#> MLTPL__1[1]="0.000501202640"/2
#> MLTPL__1[2]="-0.716863538054"/2
#> MLTPL__2[0]="-1.030685482088"/2
#> MLTPL__2[1]="-0.000054040979"/2
#> MLTPL__2[2]="0.000129568277"/2
#> MLTPL__2[3]="0.949116062724"/2
#> MLTPL__2[4]="-0.000205163718"/2
#> MLTPL__2[5]="0.081569419364"/2
#>>  12
#> GRAD[0]="-0.000001014992"/6
#> GRAD[1]="0.000040268508"/6
#> GRAD[2]="-0.008715877650"/6
#> GRAD[3]="0.000000611350"/6
#> GRAD[4]="-0.002912473144"/6
#> GRAD[5]="0.004345379995"/6
#> GRAD[6]="0.000000403642"/6
#> GRAD[7]="0.002872204636"/6
#> GRAD[8]="0.004370497655"/6
#> GRAD[0]="-0.000158601054"/6
#> GRAD[1]="0.000085445819"/6
#> GRAD[2]="-0.005632716050"/6
#> GRAD[3]="0.000001280266"/6
#> GRAD[4]="-0.001970222329"/6
#> GRAD[5]="0.003055414875"/6
#> GRAD[6]="0.000001253748"/6
#> GRAD[7]="0.001922298834"/6
#> GRAD[8]="0.003074717419"/6
#>>  13
#> GEO_ITER="2"/8
#> POTNUC="8.921896162352"/6
#> SEWARD_MLTPL1X="2.423499614999"/5
#> SEWARD_KINETIC="29.003204064678"/5
#> SEWARD_ATTRACT="-61.690280783242"/5
#> POTNUC="9.224096345167"/6
#> SCF_ITER="6"/8
#> E_SCF="-74.969053330456"/4
#> ESPF_MULTIPOLES[0]="-0.605553864505"/6
#> ESPF_MULTIPOLES[1]="0.302959190294"/6
#> ESPF_MULTIPOLES[2]="0.303135626910"/6
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="-0.000119672732"/2
#> MLTPL__1[1]="0.000521375212"/2
#> MLTPL__1[2]="-0.716528281657"/2
#> MLTPL__2[0]="-1.029663351052"/2
#> MLTPL__2[1]="-0.000053021468"/2
#> MLTPL__2[2]="0.000188091291"/2
#> MLTPL__2[3]="0.933018440573"/2
#> MLTPL__2[4]="0.000097208083"/2
#> MLTPL__2[5]="0.096644910479"/2
#>>  14
#>>  15
>>EOF
