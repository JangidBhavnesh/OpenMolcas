*-------------------------------------------------------------------------------
* Molecule: Acrolein
* Basis: ANO-R1
* Symmetry: C1
* Features tested: CASSCF,RASSI,HDF5,mort
* Responsible person: I. Fdez. GalvÃ¡n
*-------------------------------------------------------------------------------

* Skip the test if mort is not available
> IF ( -FILE $MOLCAS/Tools/mort/mort.py )
>   GOTO HAVE_MORT
> ENDIF
> EXIT 36
> LABEL HAVE_MORT
> SHELL sh create_test_numpy_h5py $MOLCAS/Tools/mort/mort.py
> SHELL ./test_numpy_h5py.py || touch TEST_NUMPY_H5PY
> IF ( -FILE TEST_NUMPY_H5PY )
>   EXIT 36
> ENDIF

* Suppose excited states are computed with the wrong orientation and atom order
* (first with minimal basis)
&GATEWAY
  Coord = 8

    C       1.769114    0.000000    0.136549
    C       0.588145    0.000000   -0.434423
    C      -0.695203    0.000000    0.361447
    O      -1.808864    0.000000   -0.137998
    H      -0.548852    0.000000    1.455362
    H       0.477859    0.000000   -1.512556
    H       2.688665    0.000000   -0.434186
    H       1.880903    0.000000    1.213924
  Basis = STO-3G
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 1 ; 1 11 13
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  StAverage = 4

* Expand basis
&GATEWAY
  Coord = $Project.rasscf.h5
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

> Exec $MOLCAS/Tools/mort/mort.py -f all $Project.rasscf.h5 $Project.guessorb.h5

&RASSCF
  File = $Project.guessorb.h5
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  CIRoot = 3 4 ; 2 3 4 ; 1 1 1

> Copy $Project.rasscf.h5 $Project.ES.h5

* This is the correct geometry we want to use for RASSI
&GATEWAY
  Coord = 8

    O      -1.808864   -0.137998    0.000000
    C       1.769114    0.136549    0.000000
    C       0.588145   -0.434423    0.000000
    C      -0.695203    0.361447    0.000000
    H      -0.548852    1.455362    0.000000
    H       0.477859   -1.512556    0.000000
    H       2.688665   -0.434186    0.000000
    H       1.880903    1.213924    0.000000
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 2 ; 1 10 14 ; 1 13 15
  Spin = 1
  Charge = 0
  NActEl = 4
  RAS2 = 4
* CIOnly run to make sure the n orbital stays in the active space
&RASSCF
  File = $Project.rasscf.h5
  CIOnly
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5

> Copy $Project.rasscf.h5 $Project.GS.h5

* Rotate and reorder the ES file to match the GS
> Copy $Project.GS.h5 JOB001
> Exec $MOLCAS/Tools/mort/mort.py -x 4,1,2,3,5,6,7,8 -r 1 0 0 0 0 1 0 1 0 $Project.ES.h5 JOB002
&RASSI
  NrOfJob = 2 all
  TRD1

>>FILE create_test_numpy_h5py
head -n 1 $1 > test_numpy_h5py.py
echo "import numpy" >> test_numpy_h5py.py
echo "import h5py" >> test_numpy_h5py.py
chmod +x test_numpy_h5py.py
>>EOF

>>FILE checkfile
* This file is autogenerated:
* Molcas version 24.06-77-g7ee3604a8
* Linux otis 5.15.0-119-generic #129-Ubuntu SMP Fri Aug 2 19:25:20 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
* Wed Aug 21 13:39:50 2024
*
#>>   1
#> POTNUC="102.496889872072"/12
#>>   2
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="3.343140945509"/5
#> SEWARD_KINETIC="15.891121812396"/5
#> SEWARD_ATTRACT="-39.964594306588"/5
#>>   3
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-188.387720899373"/4
#> E_RASSCF[1]="-188.253040574024"/4
#> E_RASSCF[2]="-188.108560906394"/4
#> E_RASSCF[3]="-188.063693937059"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.619356429994"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.198907226877"/2
#> MLTPL__2[0]="-2.269767644536"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-0.679828445358"/2
#> MLTPL__2[3]="0.418611475190"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="1.851156169346"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.256051818131"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.181487962580"/2
#> MLTPL__2[0]="-1.572836778760"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.048274956544"/2
#> MLTPL__2[3]="-0.934146672773"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="2.506983451533"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.153787889609"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.180357563005"/2
#> MLTPL__2[0]="-1.345672502996"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.142993368022"/2
#> MLTPL__2[3]="-0.887910467814"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="2.233582970810"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.632657016097"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.054950635399"/2
#> MLTPL__2[0]="-2.359162907727"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.221137534615"/2
#> MLTPL__2[3]="0.667041523133"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="1.692121384594"/2
#>>   4
#> POTNUC="102.496889872072"/12
#>>   5
#> SEWARD_MLTPL1X="3.343140945509"/5
#> SEWARD_KINETIC="23350.035000000014"/5
#> SEWARD_ATTRACT="-1200.876109041755"/5
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="3.343140945509"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-40.366510068953"/5
#>>   6
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-190.828787812528"/4
#> E_RASSCF[1]="-190.704012000739"/4
#> E_RASSCF[2]="-190.674944092592"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.005884239782"/2
#> MLTPL__1[1]="-0.000000025174"/2
#> MLTPL__1[2]="0.303661431451"/2
#> MLTPL__2[0]="-2.161456098500"/2
#> MLTPL__2[1]="0.000000205921"/2
#> MLTPL__2[2]="-0.423766235520"/2
#> MLTPL__2[3]="-0.686967637680"/2
#> MLTPL__2[4]="-0.000000065748"/2
#> MLTPL__2[5]="2.848423736180"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.361793636453"/2
#> MLTPL__1[1]="-0.000000005420"/2
#> MLTPL__1[2]="0.219017869411"/2
#> MLTPL__2[0]="-0.973097470060"/2
#> MLTPL__2[1]="0.000000046354"/2
#> MLTPL__2[2]="-0.962018120799"/2
#> MLTPL__2[3]="-2.599493178858"/2
#> MLTPL__2[4]="-0.000000089818"/2
#> MLTPL__2[5]="3.572590648918"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.311447476955"/2
#> MLTPL__1[1]="-0.000000005612"/2
#> MLTPL__1[2]="0.237910591173"/2
#> MLTPL__2[0]="-1.085360363616"/2
#> MLTPL__2[1]="0.000000089674"/2
#> MLTPL__2[2]="-1.255921080510"/2
#> MLTPL__2[3]="-2.280653679999"/2
#> MLTPL__2[4]="-0.000000084910"/2
#> MLTPL__2[5]="3.366014043615"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.779414877967"/2
#> MLTPL__1[1]="-0.000000032847"/2
#> MLTPL__1[2]="0.032867439779"/2
#> MLTPL__2[0]="-1.735812903192"/2
#> MLTPL__2[1]="0.000000252054"/2
#> MLTPL__2[2]="-1.368844292545"/2
#> MLTPL__2[3]="-0.758602307646"/2
#> MLTPL__2[4]="-0.000000071982"/2
#> MLTPL__2[5]="2.494415210837"/2
#>>   7
#> POTNUC="102.496889872072"/12
#>>   8
#> SEWARD_MLTPL1X="-3.418257559014"/5
#> SEWARD_KINETIC="90135.945000000007"/5
#> SEWARD_ATTRACT="-3134.607880329439"/5
#> POTNUC="102.496889872072"/12
#> SEWARD_MLTPL1X="-3.418257559014"/5
#> SEWARD_KINETIC="29.405679010787"/5
#> SEWARD_ATTRACT="-66.844492397528"/5
#>>   9
#> RASSCF_ITER="17"/8
#> E_RASSCF="-190.977709054890"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.103190796731"/2
#> MLTPL__1[1]="0.306217824605"/2
#> MLTPL__1[2]="0.000000062887"/2
#> MLTPL__2[0]="-2.472973342033"/2
#> MLTPL__2[1]="-0.868659716475"/2
#> MLTPL__2[2]="-0.000000301507"/2
#> MLTPL__2[3]="3.090691915821"/2
#> MLTPL__2[4]="-0.000000442993"/2
#> MLTPL__2[5]="-0.617718573788"/2
#>>  10
#> E_RASSCF="-190.977891069177"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="1.102068926807"/2
#> MLTPL__1[1]="0.305898886114"/2
#> MLTPL__1[2]="0.000000062553"/2
#> MLTPL__2[0]="-2.470716699376"/2
#> MLTPL__2[1]="-0.868248861454"/2
#> MLTPL__2[2]="-0.000000331557"/2
#> MLTPL__2[3]="3.090973998028"/2
#> MLTPL__2[4]="-0.000000372043"/2
#> MLTPL__2[5]="-0.620257298652"/2
#>>  11
#> E_RASSI[0]="-190.977941031102"/4
#> E_RASSI[1]="-190.828787812523"/4
#> E_RASSI[2]="-190.704012000734"/4
#> E_RASSI[3]="-190.674890706326"/4
#> TMS(SF,LEN)="0.000026072847"/6
#> TMS(SF,LEN)="0.000432355648"/6
#> TMS(SF,LEN)="0.008316410917"/6
#> TMS(SF,LEN)="0.002605075262"/6
#> TMS(SF,LEN)="0.000000176927"/6
#> TMS(SF,LEN)="0.000006453689"/6
#> TMS(SF,VEL)="0.000000136107"/6
#> TMS(SF,VEL)="0.000299272404"/6
#> TMS(SF,VEL)="0.005192937358"/6
#> TMS(SF,VEL)="0.002616215302"/6
#> TMS(SF,VEL)="0.000001748930"/6
#> TMS(SF,VEL)="0.000149799808"/6
>>EOF
