*-------------------------------------------------------------------------------
* Molecule: Acrolein
* Basis: ANO-R1
* Symmetry: C1
* Features tested: CASSCF,RASSI,HDF5,mort
* Responsible person: I. Fdez. GalvÃ¡n
*-------------------------------------------------------------------------------

* Skip the test if mort is not available
> IF ( -FILE $MOLCAS/Tools/mort/mort.py )
>   GOTO HAVE_MORT
> ENDIF
> EXIT 36
> LABEL HAVE_MORT
> SHELL sh create_test_numpy_h5py $MOLCAS/Tools/mort/mort.py
> SHELL ./test_numpy_h5py.py || touch TEST_NUMPY_H5PY
> IF ( -FILE TEST_NUMPY_H5PY )
>   EXIT 36
> ENDIF

* Suppose excited states are computed with the wrong orientation and atom order
* (first with minimal basis)
&GATEWAY
  Coord = 8

    C       1.769114    0.000000    0.136549
    C       0.588145    0.000000   -0.434423
    C      -0.695203    0.000000    0.361447
    O      -1.808864    0.000000   -0.137998
    H      -0.548852    0.000000    1.455362
    H       0.477859    0.000000   -1.512556
    H       2.688665    0.000000   -0.434186
    H       1.880903    0.000000    1.213924
  Basis = STO-3G
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 1 ; 1 11 13
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  StAverage = 4

* Expand basis
&GATEWAY
  Coord = $Project.rasscf.h5
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

> Exec $MOLCAS/Tools/mort/mort.py -f all $Project.rasscf.h5 $Project.guessorb.h5

&RASSCF
  File = $Project.guessorb.h5
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5
  CIRoot = 3 4 ; 2 3 4 ; 1 1 1

> Copy $Project.rasscf.h5 $Project.ES.h5

* This is the correct geometry we want to use for RASSI
&GATEWAY
  Coord = 8

    O      -1.808864   -0.137998    0.000000
    C       1.769114    0.136549    0.000000
    C       0.588145   -0.434423    0.000000
    C      -0.695203    0.361447    0.000000
    H      -0.548852    1.455362    0.000000
    H       0.477859   -1.512556    0.000000
    H       2.688665   -0.434186    0.000000
    H       1.880903    1.213924    0.000000
  Basis = ANO-R1
  Group = NoSym
  RICD

&SEWARD

&RASSCF
  File = $Project.guessorb.h5
  Alter = 2 ; 1 10 14 ; 1 13 15
  Spin = 1
  Charge = 0
  NActEl = 4
  RAS2 = 4
* CIOnly run to make sure the n orbital stays in the active space
&RASSCF
  File = $Project.rasscf.h5
  CIOnly
  Spin = 1
  Charge = 0
  NActEl = 6
  RAS2 = 5

> Copy $Project.rasscf.h5 $Project.GS.h5

* Rotate and reorder the ES file to match the GS
> Copy $Project.GS.h5 JOB001
> Exec $MOLCAS/Tools/mort/mort.py -x 4,1,2,3,5,6,7,8 -r 1 0 0 0 0 1 0 1 0 $Project.ES.h5 JOB002
&RASSI
  NrOfJob = 2 all
  TRD1

>>FILE create_test_numpy_h5py
head -n 1 $1 > test_numpy_h5py.py
echo "import numpy" >> test_numpy_h5py.py
echo "import h5py" >> test_numpy_h5py.py
chmod +x test_numpy_h5py.py
>>EOF

>>FILE checkfile
* This file is autogenerated:
* Molcas version 24.02-439-g37d164d0c
* Linux otis 5.15.0-97-generic #107-Ubuntu SMP Wed Feb 7 13:26:48 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
* Thu Apr 25 12:39:00 2024
*
#>>   1
#> POTNUC="102.496889941607"/12
#>>   2
#> POTNUC="102.496889941607"/12
#> SEWARD_MLTPL1X="3.343140943241"/5
#> SEWARD_KINETIC="15.891121812396"/5
#> SEWARD_ATTRACT="-39.964594310870"/5
#>>   3
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-188.387720899162"/4
#> E_RASSCF[1]="-188.253040573556"/4
#> E_RASSCF[2]="-188.108560905621"/4
#> E_RASSCF[3]="-188.063693936138"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.619356429870"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.198907226748"/2
#> MLTPL__2[0]="-2.269767644973"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-0.679828444969"/2
#> MLTPL__2[3]="0.418611478114"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="1.851156166859"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.256051817011"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.181487962663"/2
#> MLTPL__2[0]="-1.572836779958"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.048274956502"/2
#> MLTPL__2[3]="-0.934146670026"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="2.506983449985"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.153787888188"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.180357563292"/2
#> MLTPL__2[0]="-1.345672503027"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.142993367465"/2
#> MLTPL__2[3]="-0.887910465483"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="2.233582968510"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.632657017069"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.054950634774"/2
#> MLTPL__2[0]="-2.359162909317"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="-1.221137534868"/2
#> MLTPL__2[3]="0.667041526623"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="1.692121382694"/2
#>>   4
#> POTNUC="102.496889941607"/12
#>>   5
#> SEWARD_MLTPL1X="3.343140943241"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-1200.876109046075"/5
#> POTNUC="102.496889941607"/12
#> SEWARD_MLTPL1X="3.343140943241"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-40.366510073235"/5
#>>   6
#> RASSCF_ITER="12"/8
#> E_RASSCF[0]="-190.828787846174"/4
#> E_RASSCF[1]="-190.704012076114"/4
#> E_RASSCF[2]="-190.674943982372"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.005887601180"/2
#> MLTPL__1[1]="-0.000000000956"/2
#> MLTPL__1[2]="0.303660399512"/2
#> MLTPL__2[0]="-2.161459411763"/2
#> MLTPL__2[1]="0.000000009027"/2
#> MLTPL__2[2]="-0.423769072494"/2
#> MLTPL__2[3]="-0.686958829557"/2
#> MLTPL__2[4]="0.000000008145"/2
#> MLTPL__2[5]="2.848418241320"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.361794239061"/2
#> MLTPL__1[1]="-0.000000001082"/2
#> MLTPL__1[2]="0.219016628427"/2
#> MLTPL__2[0]="-0.973101710736"/2
#> MLTPL__2[1]="0.000000015002"/2
#> MLTPL__2[2]="-0.962017617509"/2
#> MLTPL__2[3]="-2.599486462617"/2
#> MLTPL__2[4]="0.000000005629"/2
#> MLTPL__2[5]="3.572588173353"/2
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="0.311446982136"/2
#> MLTPL__1[1]="0.000000001371"/2
#> MLTPL__1[2]="0.237909363005"/2
#> MLTPL__2[0]="-1.085363079803"/2
#> MLTPL__2[1]="0.000000027691"/2
#> MLTPL__2[2]="-1.255918043521"/2
#> MLTPL__2[3]="-2.280647343853"/2
#> MLTPL__2[4]="0.000000013903"/2
#> MLTPL__2[5]="3.366010423656"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.779408269653"/2
#> MLTPL__1[1]="-0.000000000822"/2
#> MLTPL__1[2]="0.032869517384"/2
#> MLTPL__2[0]="-1.735813614729"/2
#> MLTPL__2[1]="0.000000024343"/2
#> MLTPL__2[2]="-1.368847391475"/2
#> MLTPL__2[3]="-0.758595476965"/2
#> MLTPL__2[4]="0.000000017994"/2
#> MLTPL__2[5]="2.494409091694"/2
#>>   7
#> POTNUC="102.496889941607"/12
#>>   8
#> SEWARD_MLTPL1X="-3.418257556695"/5
#> SEWARD_KINETIC="90135.945000000036"/5
#> SEWARD_ATTRACT="-3134.607880333614"/5
#> POTNUC="102.496889941607"/12
#> SEWARD_MLTPL1X="-3.418257556695"/5
#> SEWARD_KINETIC="29.405679010787"/5
#> SEWARD_ATTRACT="-66.844492401267"/5
#>>   9
#> RASSCF_ITER="17"/8
#> E_RASSCF="-190.977709055090"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.103190802146"/2
#> MLTPL__1[1]="0.306217819977"/2
#> MLTPL__1[2]="0.000000044138"/2
#> MLTPL__2[0]="-2.472973331892"/2
#> MLTPL__2[1]="-0.868659741151"/2
#> MLTPL__2[2]="-0.000000130069"/2
#> MLTPL__2[3]="3.090691886986"/2
#> MLTPL__2[4]="-0.000000155899"/2
#> MLTPL__2[5]="-0.617718555094"/2
#>>  10
#> E_RASSCF="-190.977891069393"/4
#> MLTPL__0="-0.000000000001"/2
#> MLTPL__1[0]="1.102068932068"/2
#> MLTPL__1[1]="0.305898881432"/2
#> MLTPL__1[2]="0.000000043300"/2
#> MLTPL__2[0]="-2.470716688608"/2
#> MLTPL__2[1]="-0.868248885985"/2
#> MLTPL__2[2]="-0.000000139586"/2
#> MLTPL__2[3]="3.090973968937"/2
#> MLTPL__2[4]="-0.000000134140"/2
#> MLTPL__2[5]="-0.620257280329"/2
#>>  11
#> E_RASSI[0]="-190.977941031540"/4
#> E_RASSI[1]="-190.828787846169"/4
#> E_RASSI[2]="-190.704012076109"/4
#> E_RASSI[3]="-190.674890595587"/4
#> TMS(SF,LEN)="0.000026071766"/6
#> TMS(SF,LEN)="0.000432357499"/6
#> TMS(SF,LEN)="0.008315895994"/6
#> TMS(SF,LEN)="0.002605158892"/6
#> TMS(SF,LEN)="0.000000176907"/6
#> TMS(SF,LEN)="0.000006453783"/6
#> TMS(SF,VEL)="0.000000136391"/6
#> TMS(SF,VEL)="0.000299270582"/6
#> TMS(SF,VEL)="0.005192531157"/6
#> TMS(SF,VEL)="0.002616315561"/6
#> TMS(SF,VEL)="0.000001749060"/6
#> TMS(SF,VEL)="0.000149812251"/6
>>EOF
