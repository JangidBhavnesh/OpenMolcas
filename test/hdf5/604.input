*-------------------------------------------------------------------------------
* System: 2 PSB2 molecules
* Basis: ANO-R1
* Features tested: Frenkel exciton energies with hdf5 files
* Responsible person: I. Fdez. Galván, Luca De Vico
*-------------------------------------------------------------------------------

* Test HDF5 support
> RM -FORCE TEST_HDF5
> IF ( $MOLCAS_DRIVER = UNKNOWN_VARIABLE )
>   EXPORT MOLCAS_DRIVER=molcas
> ENDIF
> SHELL $MOLCAS_DRIVER have_feature hdf5 || touch TEST_HDF5
> IF ( -FILE TEST_HDF5 )
>   EXIT 36
> ENDIF

* Test also mort support
> IF ( -FILE $MOLCAS/Tools/mort/mort.py )
>   GOTO HAVE_MORT
> ENDIF
> EXIT 36
> LABEL HAVE_MORT
> SHELL sh create_test_numpy_h5py $MOLCAS/Tools/mort/mort.py
> SHELL ./test_numpy_h5py.py || touch TEST_NUMPY_H5PY
> IF ( -FILE TEST_NUMPY_H5PY )
>   EXIT 36
> ENDIF

>FILE create_test_numpy_h5py
head -n 1 $1 > test_numpy_h5py.py
echo "import numpy" >> test_numpy_h5py.py
echo "import h5py" >> test_numpy_h5py.py
chmod +x test_numpy_h5py.py
>EOF

> FILE PSB2-A.xyz
10

C         -1.03593        1.05292        0.0
C         -2.33477        0.74532        0.0
H         -2.66757       -0.28790        0.0
H         -3.07916        1.53468        0.0
C          0.00000        0.00000        0.0
H         -0.74127        2.09795        0.0
N          1.24994        0.30115        0.0
H         -0.29616       -1.04567        0.0
H          1.56256        1.28304        0.0
H          1.95992       -0.44520        0.0
> EOF

> FILE PSB2-B.xyz
10

C         -1.03593        1.05292        3.5
C         -2.33477        0.74532        3.5
H         -2.66757       -0.28790        3.5
H         -3.07916        1.53468        3.5
C          0.00000        0.00000        3.5
H         -0.74127        2.09795        3.5
N          1.24994        0.30115        3.5
H         -0.29616       -1.04567        3.5
H          1.56256        1.28304        3.5
H          1.95992       -0.44520        3.5
> EOF

> COPY PSB2-A.xyz .
> COPY PSB2-B.xyz .

***** SYSTEM A ******

&GATEWAY
  Coord = PSB2-A.xyz
  Basis = ANO-R1
  NoMove
  Group = NoSym
  RICD

&SEWARD

&SCF
  Charge = 1

&RASSCF
  File = $Project.scf.h5
  Charge = 1
  NActEl = 4
  RAS2 = 4
  StAverage = 3
  Alter = 2
    1 13 14
    1 17 20

&CASPT2
  File = $Project.rasscf.h5
  Multistate = all

> COPY $Project.caspt2.h5 MonA.caspt2.h5

* System B is identical but translated 3.5 Å
> EXEC $MOLCAS/Tools/mort/mort.py -t 0.0 0.0 6.6140414362 MonA.caspt2.h5 MonB.caspt2.h5

***** INTEGRALS OF A+B PART 1 ******

&GATEWAY
  Coord = PSB2-A.xyz
  Coord = PSB2-B.xyz
  BSSE = 1
  Basis = ANO-R1
  NoMove
  Group = NoSym
  RICD

&SEWARD

> COPY $Project.RunFile  AUXRFIL1

***** SYSTEM A ******

&GATEWAY
  Coord = PSB2-A.xyz
  Basis = ANO-R1
  NoMove
  Group = NoSym

&SEWARD
  FakeRICD

> COPY MonA.caspt2.h5 JOB001

&RASSI
  NrOfJobIph = 1 all
  TRD1
  TRDI
  MonA

***** INTEGRALS OF A+B PART 2 ******

&GATEWAY
  Coord = PSB2-A.xyz
  Coord = PSB2-B.xyz
  BSSE = 2
  Basis = ANO-R1
  NoMove
  Group = Nosym

&SEWARD
  FakeRICD

> COPY $Project.RunFile AUXRFIL2

***** SYSTEM B ******

&GATEWAY
  Coord = PSB2-B.xyz
  Basis = ANO-R1
  NoMove
  Group = Nosym

&SEWARD
  FakeRICD

> COPY MonB.caspt2.h5 JOB001

&RASSI
  NrOfJobIph = 1 all
  TRD1
  TRDI
  MonB
  Excitonics

>>FILE checkfile
* This file is autogenerated:
* Molcas version 24.02-106-gf59de7d62
* Linux otis 5.15.0-97-generic #107-Ubuntu SMP Wed Feb 7 13:26:48 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
* Mon Mar  4 15:22:39 2024
*
#>>   1
#> POTNUC="111.651187431299"/12
#>>   2
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-1202.220594048138"/5
#> POTNUC="111.651187431299"/12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995030447"/5
#>>   3
#> SCF_ITER="11"/8
#> E_SCF="-171.424417791019"/4
#> MLTPL__0="1"/2
#> MLTPL__1[0]="-0.040231633019"/2
#> MLTPL__1[1]="0.586769766124"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.417202910060"/2
#> MLTPL__2[1]="-2.292330370040"/2
#> MLTPL__2[2]="-0.000000000000"/2
#> MLTPL__2[3]="-0.727298146565"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.689904763495"/2
#>>   4
#> RASSCF_ITER="11"/8
#> E_RASSCF[0]="-171.458318995962"/4
#> E_RASSCF[1]="-171.211699259507"/4
#> E_RASSCF[2]="-171.153757226596"/4
#> MLTPL__0="1"/2
#> MLTPL__1[0]="0.502434965075"/2
#> MLTPL__1[1]="0.543123213966"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.555691811277"/2
#> MLTPL__2[1]="-2.090101236161"/2
#> MLTPL__2[2]="-0.000000000000"/2
#> MLTPL__2[3]="-1.052769140273"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.502922671004"/2
#> MLTPL__0="1"/2
#> MLTPL__1[0]="-1.266338546794"/2
#> MLTPL__1[1]="1.383268973558"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.684396580580"/2
#> MLTPL__2[1]="-2.340642241420"/2
#> MLTPL__2[2]="-0.000000000000"/2
#> MLTPL__2[3]="-1.424600434955"/2
#> MLTPL__2[4]="0.000000000000"/2
#> MLTPL__2[5]="-11.259796145624"/2
#> MLTPL__0="1"/2
#> MLTPL__1[0]="1.217486783925"/2
#> MLTPL__1[1]="0.745372498129"/2
#> MLTPL__1[2]="-0.000000000000"/2
#> MLTPL__2[0]="12.859398828244"/2
#> MLTPL__2[1]="-3.139663197818"/2
#> MLTPL__2[2]="-0.000000000000"/2
#> MLTPL__2[3]="-1.199208055395"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="-11.660190772848"/2
#>>   5
#> E_CASPT2="-171.991723905118"/4
#> E_CASPT2="-171.780368824892"/4
#> E_CASPT2="-171.691979628660"/4
#> E_MSPT2[0]="-171.992766270708"/4
#> E_MSPT2[1]="-171.785220023285"/4
#> E_MSPT2[2]="-171.686086064678"/4
#>>   6
#> POTNUC="111.651187431299"/12
#>>   7
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-4.224243151698"/5
#> POTNUC="111.651187431299"/12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-4.224243149007"/5
#>>   8
#> POTNUC="111.651187431299"/12
#>>   9
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-1202.220594048138"/5
#> POTNUC="111.651187431299"/12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995030447"/5
#>>  10
#> E_RASSI[0]="-171.992766270708"/7
#> E_RASSI[1]="-171.785220023284"/7
#> E_RASSI[2]="-171.686086064678"/7
#> TMS(SF,LEN)="0.657817813212"/6
#> TMS(SF,LEN)="0.084621402538"/6
#> TMS(SF,LEN)="0.004042085172"/6
#> TMS(SF,VEL)="0.654736726181"/6
#> TMS(SF,VEL)="0.080779021240"/6
#> TMS(SF,VEL)="0.022116109336"/6
#>>  11
#> POTNUC="111.651187431299"/12
#>>  12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-1202.220594048138"/5
#> POTNUC="111.651187431299"/12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995030447"/5
#>>  13
#> POTNUC="111.651187431299"/12
#>>  14
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="23350.035000000025"/5
#> SEWARD_ATTRACT="-1202.220594048138"/5
#> POTNUC="111.651187431299"/12
#> SEWARD_MLTPL1X="-1.957623984284"/5
#> SEWARD_KINETIC="16.117924744635"/5
#> SEWARD_ATTRACT="-41.710995030447"/5
#>>  15
#> E_RASSI[0]="-171.992766270708"/7
#> E_RASSI[1]="-171.785220023284"/7
#> E_RASSI[2]="-171.686086064678"/7
#> TMS(SF,LEN)="0.657817813212"/6
#> TMS(SF,LEN)="0.084621402538"/6
#> TMS(SF,LEN)="0.004042085172"/6
#> TMS(SF,VEL)="0.654736726181"/6
#> TMS(SF,VEL)="0.080779021240"/6
#> TMS(SF,VEL)="0.022116109336"/6
#> E_FRENKEL[0]="-0.010348551165"/6
#> E_FRENKEL[1]="5.227264451802"/6
#> E_FRENKEL[2]="5.717035425714"/6
#> E_FRENKEL[3]="8.299071126280"/6
#> E_FRENKEL[4]="8.444229215666"/6
#> FRENKEL_OSCSTR[0]="0.0"/6
#> FRENKEL_OSCSTR[1]="1.314118238878"/6
#> FRENKEL_OSCSTR[2]="0.0"/6
#> FRENKEL_OSCSTR[3]="0.190324904753"/6
#> FRENKEL_OSCSTR[4]="0.0"/6
#> FRENKEL_OSCSTR[5]="0.004558846670"/6
#> FRENKEL_OSCSTR[6]="0.0"/6
#> FRENKEL_OSCSTR[7]="0.0"/6
#> FRENKEL_OSCSTR[8]="0.002959708965"/6
#> FRENKEL_OSCSTR[9]="0.0"/6
>>EOF
