*-------------------------------------------------------------------------------
* Molecule: C2H2
* Basis: cc-pVDZ
* Symmetry: C1
* Features tested: NEVPT2
* Responsible person: L. Freitag
* Comments: DMRG-NEVPT2 and QD-NEVPT2 test for C2H2, CAS(4,4), 2 states
*-------------------------------------------------------------------------------

>> RM -FORCE TEST_QCMAQUIS
>> IF ( $MOLCAS_DRIVER = UNKNOWN_VARIABLE )
>>   EXPORT MOLCAS_DRIVER=molcas
>> ENDIF
>> SHELL $MOLCAS_DRIVER have_feature qcmaquis || touch TEST_QCMAQUIS
>> IF ( -FILE TEST_QCMAQUIS )
>>   EXIT 36
>> ENDIF

&GATEWAY
 coord
 4
 ang
 H   0.0000000000   0.0000000000  -1.6450541782
 C   0.0000000000   0.0000000000  -0.5832481605
 C   0.0000000000   0.0000000000   0.5832481606
 H   0.0000000000   0.0000000000   1.6450541782
 basis=cc-pvdz
 group=NOSYM
 RICD
&SEWARD

&SCF
&DMRGSCF
 ActiveSpaceOptimizer=QCMaquis
OOptimizationSettings
 nactel = 4,0,0
 inactive = 5
     RAS2 = 4
  CIROOT=2,2,1
  Alter
  1
  1 8 10
  NEVPT2Prep
  SOCC
  2200
  2ud0
EndOOptimizationSettings
DMRGSettings
    nsweeps = 20
    max_bond_dimension = 100
EndDMRGSettings
&MOTRA
Frozen=0
CTonly
Kpq
HDF5

* Test NEVPT2 calculating the RDMs on the fly
&NEVPT2
States=2

* Test the RDM reading feature by rerunning NEVPT2 with RDMRead option
&NEVPT2
States=2
RDMRead

* Test the distributed 4-RDM calculation
* Perform the RDM calculations without the queue manager
>> EXEC mv $CurrDir/$Project.checkpoint_state.0.0.0.h5 $WorkDir
>> EXEC mv $CurrDir/$Project.checkpoint_state.1.0.0.h5 $WorkDir

>> EXEC $MOLCAS/Tools/distributed-4rdm/prepare_rdm_template.sh
>> EXEC $MOLCAS/Tools/distributed-4rdm/prepare_rdm_template.sh -3
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.0 && ./jobmanager.py -n'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.0/parts && for i in *; do cd $i && sh submit-4rdm.sh && cd ..; done'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.1 && ./jobmanager.py -n'
>> SHELL sh -c 'cd $WorkDir/4rdm-scratch.1/parts && for i in *; do cd $i && sh submit-4rdm.sh && cd ..; done'
>> SHELL sh -c 'cd $WorkDir/3rdm-scratch.0.1 && ./jobmanager.py -3 -n'
>> SHELL sh -c 'cd $WorkDir/3rdm-scratch.0.1/parts && for i in *; do cd $i && sh submit-3rdm.sh && cd ..; done'
* Test reading distributed 4-RDM

&NEVPT2
States=2
DistributedRDM
$WorkDir

>>FILE checkfile
* This file is autogenerated:
* Molcas version 24.06-77-g7ee3604a8
* Linux otis 5.15.0-119-generic #129-Ubuntu SMP Fri Aug 2 19:25:20 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
* Thu Aug 22 09:41:55 2024
*
#>>   1
#> POTNUC="25.322375896970"/12
#>>   2
#> POTNUC="25.322375896970"/12
#> SEWARD_MLTPL1X="0.0"/5
#> SEWARD_KINETIC="0.499289232500"/5
#> SEWARD_ATTRACT="-5.412381509933"/5
#>>   3
#> SCF_ITER="9"/8
#> E_SCF="-76.824481552713"/4
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="0.000000004754"/2
#> MLTPL__2[0]="-2.488416066157"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-2.488416066157"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="4.976832132314"/2
#>>   4
#> RASSCF_ITER="9"/8
#> E_RASSCF[0]="-76.879930775085"/6
#> E_RASSCF[1]="-76.575755760610"/6
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="-0.000000000676"/2
#> MLTPL__2[0]="-2.391597385433"/2
#> MLTPL__2[1]="0.0"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-2.391597385435"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="4.783194770868"/2
#> MLTPL__0="-0.000000000000"/2
#> MLTPL__1[0]="0.0"/2
#> MLTPL__1[1]="0.0"/2
#> MLTPL__1[2]="-0.000000000937"/2
#> MLTPL__2[0]="-1.632328166198"/2
#> MLTPL__2[1]="0.000000000000"/2
#> MLTPL__2[2]="0.0"/2
#> MLTPL__2[3]="-1.632328166303"/2
#> MLTPL__2[4]="0.0"/2
#> MLTPL__2[5]="3.264656332501"/2
#>>   5
#>>   6
#> E_SC_NEVPT2[0]="-77.074185498645"/6
#> E_SC_NEVPT2[1]="0.000000000001"/6
#> E_PC_NEVPT2[0]="-77.074413556073"/6
#> E_PC_NEVPT2[1]="0.000000000003"/6
#>>   7
#> E_SC_NEVPT2[0]="-77.074185498645"/6
#> E_SC_NEVPT2[1]="0.000000000001"/6
#> E_PC_NEVPT2[0]="-77.074413556073"/6
#> E_PC_NEVPT2[1]="0.000000000003"/6
#>>   8
#> E_SC_NEVPT2[0]="-77.074185498645"/6
#> E_SC_NEVPT2[1]="0.000000000001"/6
#> E_PC_NEVPT2[0]="-77.074413556073"/6
#> E_PC_NEVPT2[1]="0.000000000003"/6
>>EOF
